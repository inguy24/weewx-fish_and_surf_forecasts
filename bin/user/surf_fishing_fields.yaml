# WeeWX Surf & Fishing Forecast Extension Configuration
# Phase II: Local Surf & Fishing Forecast System
# Reorganized by data source for logical structure
#
# This file is read by install.py during installation to configure
# the extension. The service reads configuration from weewx.conf only.

# =============================================================================
# NOAA GFS WAVE DATA SOURCE - All GFS Wave configuration together
# =============================================================================
noaa_gfs_wave:
  description: "NOAA GFS-Wave Model (WaveWatch III coupled with GFS)"
  base_url: "https://nomads.ncep.noaa.gov/pub/data/nccf/com/gfs/prod/"
  url_pattern: "gfs.{yyyymmdd}/{hh}/wave/gridded/"
  file_pattern: "gfswave.t{hh}z.{grid_name}.f{fff}.grib2"
  documentation: "https://polar.ncep.noaa.gov/waves/Model_Description.pdf"
  
  # Grid definitions with selection logic combined
  grids:
    us_east_coast:
      description: "US East Coast & Gulf (16km resolution)"
      grid_name: "atlocn.0p16"
      bounds: [0, 55, -100, -50]  # lat_min, lat_max, lon_min, lon_max
      resolution: 0.16
      priority: 1
      geographic_selection:
        regions: ["us_east_coast", "us_gulf_coast"]
        bounds: [24.0, 50.0, -100.0, -65.0]
        backup_grid: "global.0p16"
        
    us_west_coast:
      description: "US West Coast (16km resolution)" 
      grid_name: "wcoast.0p16"
      bounds: [25, 50, -150, -110]
      resolution: 0.16
      priority: 1
      geographic_selection:
        regions: ["us_west_coast"]
        bounds: [24.0, 50.0, -130.0, -95.0]
        backup_grid: "global.0p16"
        
    hawaii_pacific:
      description: "Hawaii & Eastern Pacific (16km resolution)"
      grid_name: "epacif.0p16"
      bounds: [-20, 30, -180, -130]
      resolution: 0.16
      priority: 1
      geographic_selection:
        regions: ["hawaii"]
        bounds: [18.0, 23.0, -162.0, -154.0]
        backup_grid: "global.0p16"
        
    alaska_arctic:
      description: "Alaska & Arctic (9km resolution)"
      grid_name: "arctic.9km"
      bounds: [50, 90, -180, 180]
      resolution: 0.083
      priority: 1
      geographic_selection:
        regions: ["alaska"]
        bounds: [55.0, 72.0, -180.0, -130.0]
        backup_grid: "global.0p16"
        
    global_primary:
      description: "Global mid-latitudes (16km resolution)"
      grid_name: "global.0p16"
      bounds: [-15, 52.5, -180, 180]
      resolution: 0.16
      priority: 2
      geographic_selection:
        regions: ["great_lakes", "global_fallback"]
        bounds: [-90, 90, -180, 180]  # Global coverage
        backup_grid: "global.0p25"
        
    global_fallback:
      description: "Global interpolated (25km resolution)"
      grid_name: "global.0p25"
      bounds: [-90, 90, -180, 180]
      resolution: 0.25
      priority: 3
      geographic_selection:
        regions: ["global"]
        bounds: [-90, 90, -180, 180]
        backup_grid: null  # No backup - this IS the backup

  # Grid selection configuration
  grid_selection:
    method: "geographic_priority"
    fallback_enabled: true
    default_grid: "global.0p25"
  
  # API schedule and timing
  schedule:
    model_runs: [0, 6, 12, 18]  # UTC hours
    forecast_hours: [0, 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 42, 48, 54, 60, 66, 72]
    data_availability_delay: 180  # minutes after model run
    update_frequency: 21600  # 6 hours in seconds
  
  # Error handling for GFS Wave API
  error_handling:
    max_retries: 3
    timeout_seconds: 30
    backoff_multiplier: 2
    max_backoff_seconds: 300
    retry_on_http_codes: [500, 502, 503, 504, 429]
  
  # Quality control for GFS Wave data
  quality_control:
    max_data_age_hours: 6
    wave_height_max: 30.0  # meters
    wave_period_max: 30.0  # seconds
    wind_speed_max: 100.0  # m/s
  
  # All GFS Wave field mappings
  field_mappings:
    # Essential wave parameters (HIGH priority)
    wave_height:
      grib_parameter: "HTSGW"
      database_field: "wave_height"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 1
      description: "Significant height of combined wind waves and swell"
      
    wave_period:
      grib_parameter: "PERPW"
      database_field: "wave_period"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 1
      description: "Mean period of combined wind waves and swell"
      
    wave_direction:
      grib_parameter: "DIRPW"
      database_field: "wave_direction"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 1
      description: "Direction of combined wind waves and swell"
      
    # Essential wind parameters (HIGH priority)
    wind_speed:
      grib_parameter: "WIND"
      database_field: "wind_speed"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 1
      description: "Wind speed at 10 meters"
      
    wind_direction:
      grib_parameter: "WDIR"
      database_field: "wind_direction"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 1
      description: "Wind direction at 10 meters"
      
    # Primary swell components (HIGH priority)
    swell_1_height:
      grib_parameter: "SWELL:1"
      database_field: "swell_1_height"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 1
      description: "Significant wave height of first swell partition"
      
    swell_1_period:
      grib_parameter: "SWPER:1"
      database_field: "swell_1_period"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 1
      description: "Mean wave period of first swell partition"
      
    swell_1_direction:
      grib_parameter: "SWDIR:1"
      database_field: "swell_1_direction"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 1
      description: "Mean wave direction of first swell partition"
      
    # Wind wave components (MEDIUM priority)
    wind_wave_height:
      grib_parameter: "WVHGT"
      database_field: "wind_wave_height"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 2
      description: "Significant height of wind waves"
      
    wind_wave_period:
      grib_parameter: "WVPER"
      database_field: "wind_wave_period"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 2
      description: "Mean period of wind waves"
      
    wind_wave_direction:
      grib_parameter: "WVDIR"
      database_field: "wind_wave_direction"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 2
      description: "Direction of wind waves"
      
    # Secondary swell components (MEDIUM priority)
    swell_2_height:
      grib_parameter: "SWELL:2"
      database_field: "swell_2_height"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 2
      description: "Significant wave height of second swell partition"
      
    swell_2_period:
      grib_parameter: "SWPER:2"
      database_field: "swell_2_period"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 2
      description: "Mean wave period of second swell partition"
      
    swell_2_direction:
      grib_parameter: "SWDIR:2"
      database_field: "swell_2_direction"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 2
      description: "Mean wave direction of second swell partition"
      
    # Wind components for calculations (LOW priority)
    wind_u:
      grib_parameter: "UGRD"
      database_field: "wind_u"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 3
      description: "U-component of wind"
      
    wind_v:
      grib_parameter: "VGRD"
      database_field: "wind_v"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 3
      description: "V-component of wind"

# =============================================================================
# BATHYMETRY DATA SOURCE - Future data source placeholder
# =============================================================================
bathymetry_data:
  # Placeholder for future bathymetry API configuration
  # Will be added when bathymetry integration is implemented
  description: "Placeholder for future bathymetry data integration"
  enabled: false

# =============================================================================
# FISH CATEGORIES - User-configurable species targeting
# =============================================================================
fish_categories:
  freshwater_sport:
    display_name: "Freshwater Sport Fish"
    species: ["Bass", "Trout", "Pike", "Walleye"]
    pressure_preference: "falling"
    tide_relevance: false
    
  saltwater_inshore:
    display_name: "Saltwater Inshore"
    species: ["Redfish", "Snook", "Flounder", "Spotted Sea Trout"]
    pressure_preference: "falling"
    tide_relevance: true
    
  saltwater_offshore:
    display_name: "Saltwater Offshore"
    species: ["Mahi", "Tuna", "Marlin", "Wahoo"]
    pressure_preference: "stable"
    tide_relevance: false
    
  bottom_fish:
    display_name: "Bottom Fish"
    species: ["Grouper", "Snapper", "Halibut", "Cod"]
    pressure_preference: "stable_high"
    tide_relevance: true

# =============================================================================
# SCORING CRITERIA - User-tunable forecast scoring thresholds
# =============================================================================
surf_scoring:
  wave_height_scoring:
    # Score multipliers based on wave height (feet) - Users can tune these
    0-1: 0.1     # Flat conditions
    1-3: 0.6     # Small surf
    3-6: 1.0     # Good surf
    6-10: 0.9    # Large surf
    10-15: 0.7   # Very large
    15+: 0.3     # Dangerous conditions
    
  wave_period_scoring:
    # Score multipliers based on wave period (seconds)
    0-8: 0.3     # Wind swell (poor quality)
    8-12: 0.7    # Mixed swell
    12-16: 1.0   # Good ground swell
    16-20: 0.9   # Very long period
    20+: 0.8     # Extremely long period
    
  wind_scoring:
    # Wind direction relative to surf spot orientation
    offshore: 1.0      # Clean conditions
    cross_shore: 0.6   # Manageable
    onshore: 0.2       # Poor conditions
    
  wind_speed_scoring:
    # Score multipliers based on wind speed (mph)
    0-5: 1.0     # Glassy conditions
    5-10: 0.9    # Light offshore
    10-15: 0.7   # Moderate wind
    15-20: 0.4   # Strong wind
    20+: 0.1     # Dangerous conditions

fishing_scoring:
  pressure_trend_scoring:
    rising_fast: 0.3      # Fish shut down
    rising_slow: 0.7      # Decent fishing
    stable_high: 1.0      # Excellent conditions
    stable_low: 0.6       # Fair conditions
    falling_slow: 0.9     # Very good fishing
    falling_fast: 0.8     # Good before front
    
  tide_phase_scoring:
    # Relative to high/low tide timing
    incoming: 0.9         # Fish feeding as water rises
    high_slack: 0.6       # Slower fishing at high tide
    outgoing: 1.0         # Peak fishing as tide drops
    low_slack: 0.4        # Typically slower fishing
    
  time_of_day_scoring:
    # Based on typical fish feeding patterns
    dawn: 1.0            # Prime feeding time
    morning: 0.8         # Good fishing
    midday: 0.4          # Typically slower
    afternoon: 0.6       # Moderate fishing
    dusk: 1.0            # Prime feeding time
    night: 0.7           # Species dependent

# =============================================================================
# REORGANIZATION SUMMARY
# =============================================================================
# ORGANIZED BY DATA SOURCE:
# 1. noaa_gfs_wave - All GFS Wave data (grids + selection + fields + errors + QC)
# 2. bathymetry_data - Future data source placeholder  
# 3. fish_categories - User species configuration
# 4. scoring_criteria - User-tunable thresholds
#
# HARDCODED IN CODE (not in YAML):
# - Phase I integration methods (dependency requirement)
# - Unit conversion factors (never change)
# - Database schema for calculated fields
# - Method names and internal logic structure