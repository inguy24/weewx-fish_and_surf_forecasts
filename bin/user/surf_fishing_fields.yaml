# WeeWX Surf & Fishing Forecast Extension Configuration
# Phase II: Local Surf & Fishing Forecast System
# Data-driven configuration for install.py
#
# This file is read by install.py during installation to configure
# the extension. The service reads configuration from weewx.conf only.

# WaveWatch III API Configuration
api_endpoints:
  wavewatch_iii:
    description: "NOAA WaveWatch III Global Wave Model"
    base_url: "https://nomads.ncep.noaa.gov/pub/data/nccf/com/wave/prod/"
    documentation: "https://polar.ncep.noaa.gov/waves/wavewatch/"
    
    # Regional grids for improved resolution
    grids:
      us_east:
        description: "US East Coast (7km resolution)"
        grid_name: "nah"
        bounds: [24.0, 50.0, -95.0, -65.0]
        resolution: 0.067  # degrees
        file_pattern: "nww3.{yyyymmdd}/nah.t{hh}z.grib2"
        
      us_west:
        description: "US West Coast (7km resolution)" 
        grid_name: "nep"
        bounds: [24.0, 50.0, -130.0, -95.0]
        resolution: 0.067  # degrees
        file_pattern: "nww3.{yyyymmdd}/nep.t{hh}z.grib2"
        
      great_lakes:
        description: "Great Lakes (2.5km resolution)"
        grid_name: "glw"
        bounds: [41.0, 49.0, -93.0, -76.0]
        resolution: 0.027  # degrees
        file_pattern: "nww3.{yyyymmdd}/glw.t{hh}z.grib2"
        
      global_30m:
        description: "Global 30 arc-minute"
        grid_name: "glo_30m"
        bounds: [-90.0, 90.0, -180.0, 180.0]
        resolution: 0.5  # degrees
        file_pattern: "nww3.{yyyymmdd}/glo_30m.t{hh}z.grib2"
    
    # Wave parameters available in GRIB files
    parameters:
      - name: "Significant height of combined wind waves and swell"
        field: "wave_height"
        units: "meters"
        conversion_factor: 3.28084  # Convert to feet
        grib_parameter: "HTSGW"
        
      - name: "Primary wave mean period" 
        field: "wave_period"
        units: "seconds"
        grib_parameter: "PERPW"
        
      - name: "Primary wave direction"
        field: "wave_direction"
        units: "degrees"
        grib_parameter: "DIRPW"
        
      - name: "Wind wave height"
        field: "wind_wave_height"
        units: "meters"
        conversion_factor: 3.28084
        grib_parameter: "WVHGT"
        
      - name: "Swell height"
        field: "swell_height" 
        units: "meters"
        conversion_factor: 3.28084
        grib_parameter: "SWELL"

# GFS Wind Data (atmospheric component)
gfs_atmospheric:
  description: "NOAA GFS Model for wind data"
  base_url: "https://nomads.ncep.noaa.gov/pub/data/nccf/com/gfs/prod/"
  file_pattern: "gfs.{yyyymmdd}/{hh}/atmos/gfs.t{hh}z.pgrb2.0p25.f{fff}"
  parameters:
    - "UGRD:10 m above ground"
    - "VGRD:10 m above ground"

# Fish Category Definitions
fish_categories:
  freshwater_sport:
    display_name: "Freshwater Sport Fish"
    description: "Bass, trout, pike, and other freshwater species"
    species: ["Largemouth Bass", "Smallmouth Bass", "Trout", "Pike", "Walleye", "Perch"]
    pressure_preference: "falling"
    tide_relevance: false
    optimal_conditions:
      - "Dawn and dusk feeding periods"
      - "Falling barometric pressure"
      - "Overcast skies"
      - "Water temperature 55-75°F"
    
  saltwater_inshore:
    display_name: "Saltwater Inshore"
    description: "Near-shore saltwater species"
    species: ["Striped Bass", "Redfish", "Snook", "Flounder", "Sea Trout", "Bluefish"]
    pressure_preference: "falling"
    tide_relevance: true
    optimal_conditions:
      - "Moving water (2 hours before/after tide change)"
      - "Falling barometric pressure"
      - "Dawn and dusk periods"
      - "Water temperature 60-80°F"
    
  saltwater_offshore:
    display_name: "Saltwater Offshore"
    description: "Deep water and pelagic species"
    species: ["Tuna", "Mahi-mahi", "Marlin", "Sailfish", "Wahoo", "Shark"]
    pressure_preference: "stable"
    tide_relevance: false
    optimal_conditions:
      - "Stable weather systems"
      - "Clear water conditions"
      - "Baitfish activity"
      - "Water temperature 70-85°F"
      
  surf_fishing:
    display_name: "Surf Fishing"
    description: "Beach and surf zone fishing"
    species: ["Striped Bass", "Bluefish", "Flounder", "Pompano", "Whiting", "Drum"]
    pressure_preference: "falling"
    tide_relevance: true
    optimal_conditions:
      - "Incoming tide for 2 hours"
      - "Wave height 2-5 feet"
      - "Falling pressure"
      - "Early morning or evening"
      
  pier_fishing:
    display_name: "Pier Fishing"
    description: "Fishing from piers and jetties"
    species: ["Mackerel", "Croaker", "Spot", "Flounder", "Sheepshead", "Triggerfish"]
    pressure_preference: "stable"
    tide_relevance: true
    optimal_conditions:
      - "Moving water periods"
      - "Moderate wave action"
      - "Stable to falling pressure"
      - "Dawn, dusk, and night fishing"
      
  mixed_bag:
    display_name: "Mixed Species"
    description: "General fishing for various species"
    species: ["Various", "Seasonal Species", "Local Favorites"]
    pressure_preference: "stable"
    tide_relevance: true
    optimal_conditions:
      - "Early morning and evening"
      - "Changing tides"
      - "Stable weather patterns"
      - "Local baitfish activity"

# Surf Rating Factors and Weights
surf_rating_factors:
  description: "Factors used in surf quality assessment"
  
  # Weighting for overall surf quality calculation
  rating_weights:
    period: 0.4     # Wave period most important (40%)
    size: 0.3       # Wave size second most important (30%)
    wind: 0.2       # Wind conditions third (20%)
    consistency: 0.1 # Wave consistency least weighted (10%)
  
  # Wave period quality thresholds
  period_thresholds:
    excellent: 14    # 14+ seconds = excellent groundswell
    good: 11        # 11-13 seconds = good swell
    fair: 8         # 8-10 seconds = fair swell
    poor: 6         # 6-7 seconds = poor wind swell
    # <6 seconds = very poor/flat
  
  # Spot-specific size preferences (feet)
  size_preferences:
    reef_breaks:
      optimal_min: 3.0
      optimal_max: 8.0
      description: "Reef breaks handle bigger waves"
      
    beach_breaks:
      optimal_min: 1.5
      optimal_max: 5.0
      description: "Beach breaks versatile size range"
      
    point_breaks:
      optimal_min: 2.0
      optimal_max: 6.0
      description: "Point breaks work in medium range"
      
    jetty_breaks:
      optimal_min: 2.0
      optimal_max: 5.0
      description: "Jetties work best smaller"
  
  # Wind effect classifications
  wind_effects:
    offshore:
      description: "Wind blowing from land to ocean"
      effect: "Clean, groomed wave faces"
      quality_impact: "very_positive"
      ideal_speed_range: [5, 15]  # mph
      
    onshore:
      description: "Wind blowing from ocean to land"
      effect: "Choppy, blown out conditions"
      quality_impact: "negative"
      max_acceptable_speed: 10  # mph
      
    cross_shore:
      description: "Wind blowing parallel to shore"
      effect: "Variable impact on wave quality"
      quality_impact: "neutral"
      acceptable_speed_range: [0, 20]  # mph
      
    glassy:
      description: "No wind or very light wind"
      effect: "Smooth, clean wave faces"
      quality_impact: "positive"
      speed_range: [0, 3]  # mph

# Forecast Algorithm Parameters
forecast_algorithms:
  surf_rating:
    # Star rating thresholds (1-5 stars)
    excellent_threshold: 4.5
    good_threshold: 3.5
    fair_threshold: 2.5
    poor_threshold: 1.5
    
    # Quality descriptors
    quality_terms:
      5: "Epic"
      4: "Excellent" 
      3: "Good"
      2: "Fair"
      1: "Poor"
      0: "Flat"
  
  fishing_rating:
    # Activity rating thresholds (1-5 stars)
    excellent_threshold: 4.5
    good_threshold: 3.5
    fair_threshold: 2.5
    slow_threshold: 1.5
    
    # Activity descriptors
    activity_terms:
      5: "Excellent"
      4: "Good"
      3: "Fair"
      2: "Slow"
      1: "Poor"

# Station Integration Parameters
station_integration:
  description: "Configuration for integrating WeeWX station data"
  
  # Distance thresholds for station data relevance
  relevance_thresholds:
    pressure_useful_km: 25       # 15+ miles - Pressure systems regional  
    temperature_useful_km: 5     # 3 miles - Air temperature local variations
    tide_useful_km: 8            # 5 miles - Pressure data highly valuable within 5km
    wind_useful_km: 8            # 5 miles - Wind data useful within 5km coastal zone
    
  # Quality control parameters
  quality_control:
    max_data_age_hours: 6        # Operational requirement for fresh data
    pressure_variance_threshold: 5.0  # hPa - flag if stations disagree more
    consistency_check_required: true

# WaveWatch III Configuration
wavewatch_endpoints:
  base_url: "https://nomads.ncep.noaa.gov/pub/data/nccf/com/wave/prod/"
  grids:
    us_east:
      description: "US East Coast (7km resolution)"
      bounds: [24, 50, -95, -65]
      update_frequency: "6_hours"
    us_west: 
      description: "US West Coast (7km resolution)"
      bounds: [24, 50, -130, -95]
      update_frequency: "6_hours"
    glo_30m:
      description: "Global 30 arc-minute"
      bounds: [-90, 90, -180, 180]
      update_frequency: "6_hours"
  
  # Wave parameters to extract from GRIB files
  parameters:
    - name: "Significant height of combined wind waves and swell"
      field: "wave_height"
      units: "meters"
      conversion_factor: 3.28084  # Convert to feet
      grib_parameter: "HTSGW"
    - name: "Primary wave mean period" 
      field: "wave_period"
      units: "seconds"
      grib_parameter: "PERPW"
    - name: "Primary wave direction"
      field: "wave_direction"
      units: "degrees"
      grib_parameter: "DIRPW"
    - name: "Wind wave height"
      field: "wind_wave_height"
      units: "meters"
      conversion_factor: 3.28084
      grib_parameter: "WVHGT"

# Data Source Methods
data_source_methods:
  noaa_only:
    display_name: "NOAA APIs Only"
    description: "Use NDBC, CO-OPS, and WaveWatch III data"
    sensors:
      wind: false
      pressure: false
      temperature: false
    advantages:
      - "Most comprehensive offshore data"
      - "Proven API reliability"
      - "No local sensor requirements"
    requirements:
      - "Internet connection only"
    
  station_supplement:
    display_name: "Station Supplement"
    description: "Supplement NOAA data with station sensors"
    sensors:
      wind: true
      pressure: true
      temperature: true
    advantages:
      - "Hyper-local wind conditions"
      - "Real-time pressure trends"
      - "Site-specific temperature"
    requirements:
      - "WeeWX station within 5km of forecast location"
      - "Wind and barometric pressure sensors required"
    
  station_primary:
    display_name: "Station Primary"
    description: "Use station as primary data source"
    sensors:
      wind: true
      pressure: true
      temperature: true
    advantages:
      - "Hyper-local conditions"
      - "Real-time updates"
      - "Custom sensor integration"
    requirements:
      - "WeeWX station at forecast location"
      - "Full weather sensor suite required"
      - "Less accurate for offshore conditions"

# Forecast Periods Configuration
forecast_periods:
  surf:
    description: "Surf forecast periods (hourly)"
    periods_per_day: 8
    interval_hours: 3
    start_hour: 0   # UTC
    periods: ["00:00", "03:00", "06:00", "09:00", "12:00", "15:00", "18:00", "21:00"]
    forecast_days: 3
    
  fishing:
    description: "Fishing forecast periods (activity-based)"
    periods_per_day: 6
    periods:
      early_morning:
        start_hour: 4
        end_hour: 8
        description: "Dawn feeding period"
        
      morning:
        start_hour: 8
        end_hour: 12
        description: "Morning activity"
        
      midday:
        start_hour: 12
        end_hour: 16
        description: "Midday period"
        
      afternoon:
        start_hour: 16
        end_hour: 20
        description: "Afternoon activity"
        
      evening:
        start_hour: 20
        end_hour: 24
        description: "Evening feeding period"
        
      night:
        start_hour: 0
        end_hour: 4
        description: "Night fishing"
    forecast_days: 3

# Required field configuration
required_fields:
  surf_forecasting:
    critical:
      - wave_height               # Primary surf quality factor
      - wave_period               # Surf quality indicator
      - wind_speed                # Surface conditions
      - wind_direction            # Onshore/offshore assessment
    
    recommended:
      - wave_direction            # Swell direction for spot-specific forecasts
      - sea_surface_temp          # Seasonal surf quality factors
      - barometric_pressure       # Weather pattern stability
      - current_water_level       # Beach access, rip current assessment

  fishing_forecasting:
    critical:
      - barometric_pressure       # Primary fishing activity indicator
      - current_water_level       # Real-time tide information
      - tide_predictions          # Future fishing time planning
    
    recommended:
      - wind_speed               # Surface conditions affect fishing
      - wind_direction           # Fishing spot accessibility
      - sea_surface_temp         # Species activity indicator
      - coastal_water_temp       # Seasonal fishing patterns

# Coverage Thresholds for Field Adequacy Assessment
coverage_thresholds:
  critical_field_coverage: 1.0      # Must have ALL critical fields
  recommended_field_coverage: 0.75  # Should have 75%+ of recommended
  minimum_overall_coverage: 0.8     # 80% of total required fields

# Field Priority Rankings for Recommendations
field_priorities:
  surf_priority:
    1: wave_height
    2: wave_period  
    3: wind_speed
    4: wind_direction
    5: wave_direction
  
  fishing_priority:
    1: barometric_pressure
    2: tide_predictions
    3: current_water_level
    4: wind_speed
    5: sea_surface_temp

# Multi-Source Data Fusion Parameters
fusion_parameters:
  atmospheric_fusion:
    distance_weight_enabled: true
    quality_confidence_enabled: true
    temporal_consistency_check: true
    
    weights:
      primary_source: 0.6
      secondary_source: 0.3
      tertiary_source: 0.1
      
    confidence_factors:
      single_source: 0.7
      two_sources: 0.9
      three_plus_sources: 1.0

# Station Calibration Factors (Thomas et al. 2011 methodology)
calibration_factors:
  buoy_types:
    standard_buoy: 1.0
    cman_station: 0.95
    coastal_station: 0.9
    
  measurement_corrections:
    wind_speed_systematic: 1.05     # Buoy wind speed correction
    pressure_offset: 0.0            # No systematic pressure correction needed

# Quality Control Parameters
quality_control:
  max_data_age_hours: 6        # Operational requirement for fresh data
  pressure_variance_threshold: 5.0  # hPa - flag if stations disagree more
  consistency_check_required: true
  outlier_detection_enabled: true

# Database Schema - FORECAST DATA ONLY (locations stored in CONF)
database_schema:
  surf_forecast_table:
    name: "marine_forecast_surf_data"
    fields:
      id: "INTEGER PRIMARY KEY"
      spot_id: "TEXT NOT NULL"          # References CONF location ID
      forecast_time: "INTEGER NOT NULL"
      generated_time: "INTEGER NOT NULL"
      wave_height_min: "REAL"
      wave_height_max: "REAL"
      wave_height_range: "TEXT"
      wave_period: "REAL"
      wave_direction: "REAL"
      wind_speed: "REAL"
      wind_direction: "REAL"
      wind_condition: "TEXT"
      quality_rating: "INTEGER"
      quality_stars: "TEXT"
      quality_text: "TEXT"
      conditions_description: "TEXT"
      confidence: "REAL"
      
  fishing_forecast_table:
    name: "marine_forecast_fishing_data"
    fields:
      id: "INTEGER PRIMARY KEY"
      spot_id: "TEXT NOT NULL"          # References CONF location ID
      forecast_date: "INTEGER NOT NULL"
      period_name: "VARCHAR(50) NOT NULL"
      period_start_hour: "INTEGER"
      period_end_hour: "INTEGER"
      generated_time: "INTEGER NOT NULL"
      pressure_trend: "TEXT"
      pressure_change: "REAL"
      pressure_score: "INTEGER"
      tide_stage: "TEXT"
      tide_flow: "TEXT"
      tide_score: "INTEGER"
      species_activity: "TEXT"
      activity_rating: "INTEGER"
      best_species_json: "TEXT"
      conditions_text: "TEXT"
      overall_score: "REAL"
      confidence: "REAL"

# Installation Messages
installation_messages:
  pre_install:
    - "Installing Phase II: Surf & Fishing Forecast System"
    - "This extension requires Phase I Marine Data Extension"
    - "GRIB processing libraries will be detected automatically"
    - "User locations will be configured in WeeWX configuration file"
    
  post_install:
    - "Installation completed successfully!"
    - "Forecast data tables created in database"
    - "User locations stored in WeeWX configuration"
    - "Database contains NO user location tables (CONF-based storage)"
    - "Restart WeeWX to activate the surf and fishing forecasts"