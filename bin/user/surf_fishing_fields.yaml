# WeeWX Surf & Fishing Forecast Extension Configuration
# Phase II: Local Surf & Fishing Forecast System
# Reorganized by data source for logical structure
#
# This file is read by install.py during installation to configure
# the extension. The service reads configuration from weewx.conf only.

# =============================================================================
# NOAA GFS WAVE DATA SOURCE - All GFS Wave configuration together
# =============================================================================
noaa_gfs_wave:
  description: "NOAA GFS-Wave Model (WaveWatch III coupled with GFS)"
  base_url: "https://nomads.ncep.noaa.gov/pub/data/nccf/com/gfs/prod/"
  url_pattern: "gfs.{yyyymmdd}/{hh}/wave/gridded/"
  file_pattern: "gfswave.t{hh}z.{grid_name}.f{fff}.grib2"
  documentation: "https://polar.ncep.noaa.gov/waves/Model_Description.pdf"
  
  # Grid definitions with selection logic combined
  grids:
    us_east_coast:
      description: "US East Coast & Gulf (16km resolution)"
      grid_name: "atlocn.0p16"
      bounds: [0, 55, -100, -50]  # lat_min, lat_max, lon_min, lon_max
      resolution: 0.16
      priority: 1
      geographic_selection:
        regions: ["us_east_coast", "us_gulf_coast"]
        bounds: [24.0, 50.0, -100.0, -65.0]
        backup_grid: "global.0p16"
        
    us_west_coast:
      description: "US West Coast (16km resolution)" 
      grid_name: "wcoast.0p16"
      bounds: [25, 50, -150, -110]
      resolution: 0.16
      priority: 1
      geographic_selection:
        regions: ["us_west_coast"]
        bounds: [24.0, 50.0, -130.0, -95.0]
        backup_grid: "global.0p16"
        
    hawaii_pacific:
      description: "Hawaii & Eastern Pacific (16km resolution)"
      grid_name: "epacif.0p16"
      bounds: [-20, 30, -180, -130]
      resolution: 0.16
      priority: 1
      geographic_selection:
        regions: ["hawaii"]
        bounds: [18.0, 23.0, -162.0, -154.0]
        backup_grid: "global.0p16"
        
    alaska_arctic:
      description: "Alaska & Arctic (9km resolution)"
      grid_name: "arctic.9km"
      bounds: [50, 90, -180, 180]
      resolution: 0.083
      priority: 1
      geographic_selection:
        regions: ["alaska"]
        bounds: [55.0, 72.0, -180.0, -130.0]
        backup_grid: "global.0p16"
        
    global_primary:
      description: "Global mid-latitudes (16km resolution)"
      grid_name: "global.0p16"
      bounds: [-15, 52.5, -180, 180]
      resolution: 0.16
      priority: 2
      geographic_selection:
        regions: ["great_lakes", "global_fallback"]
        bounds: [-90, 90, -180, 180]  # Global coverage
        backup_grid: "global.0p25"
        
    global_fallback:
      description: "Global interpolated (25km resolution)"
      grid_name: "global.0p25"
      bounds: [-90, 90, -180, 180]
      resolution: 0.25
      priority: 3
      geographic_selection:
        regions: ["global"]
        bounds: [-90, 90, -180, 180]
        backup_grid: null  # No backup - this IS the backup

  # Grid selection configuration
  grid_selection:
    method: "geographic_priority"
    fallback_enabled: true
    default_grid: "global.0p25"
  
  # API schedule and timing
  schedule:
    model_runs: [0, 6, 12, 18]  # UTC hours
    forecast_hours: [0, 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 42, 48, 54, 60, 66, 72]
    data_availability_delay: 180  # minutes after model run
    update_frequency: 21600  # 6 hours in seconds
  
  # Error handling for GFS Wave API
  error_handling:
    max_retries: 3
    timeout_seconds: 30
    backoff_multiplier: 2
    max_backoff_seconds: 300
    retry_on_http_codes: [500, 502, 503, 504, 429]
  
  # Quality control for GFS Wave data
  quality_control:
    max_data_age_hours: 6
    wave_height_max: 30.0  # meters
    wave_period_max: 30.0  # seconds
    wind_speed_max: 100.0  # m/s
  
  # All GFS Wave field mappings
  field_mappings:
    # Essential wave parameters (HIGH priority)
    wave_height:
      grib_parameter: "HTSGW"
      database_field: "wave_height"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 1
      description: "Significant height of combined wind waves and swell"
      
    wave_period:
      grib_parameter: "PERPW"
      database_field: "wave_period"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 1
      description: "Mean period of combined wind waves and swell"
      
    wave_direction:
      grib_parameter: "DIRPW"
      database_field: "wave_direction"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 1
      description: "Direction of combined wind waves and swell"
      
    # Essential wind parameters (HIGH priority)
    wind_speed:
      grib_parameter: "WIND"
      database_field: "wind_speed"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 1
      description: "Wind speed at 10 meters"
      
    wind_direction:
      grib_parameter: "WDIR"
      database_field: "wind_direction"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 1
      description: "Wind direction at 10 meters"
      
    # Primary swell components (HIGH priority)
    swell_1_height:
      grib_parameter: "SWELL:1"
      database_field: "swell_1_height"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 1
      description: "Significant wave height of first swell partition"
      
    swell_1_period:
      grib_parameter: "SWPER:1"
      database_field: "swell_1_period"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 1
      description: "Mean wave period of first swell partition"
      
    swell_1_direction:
      grib_parameter: "SWDIR:1"
      database_field: "swell_1_direction"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 1
      description: "Mean wave direction of first swell partition"
      
    # Wind wave components (MEDIUM priority)
    wind_wave_height:
      grib_parameter: "WVHGT"
      database_field: "wind_wave_height"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 2
      description: "Significant height of wind waves"
      
    wind_wave_period:
      grib_parameter: "WVPER"
      database_field: "wind_wave_period"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 2
      description: "Mean period of wind waves"
      
    wind_wave_direction:
      grib_parameter: "WVDIR"
      database_field: "wind_wave_direction"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 2
      description: "Direction of wind waves"
      
    # Secondary swell components (MEDIUM priority)
    swell_2_height:
      grib_parameter: "SWELL:2"
      database_field: "swell_2_height"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 2
      description: "Significant wave height of second swell partition"
      
    swell_2_period:
      grib_parameter: "SWPER:2"
      database_field: "swell_2_period"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 2
      description: "Mean wave period of second swell partition"
      
    swell_2_direction:
      grib_parameter: "SWDIR:2"
      database_field: "swell_2_direction"
      database_type: "REAL"
      unit_conversion_required: false
      forecast_priority: 2
      description: "Mean wave direction of second swell partition"
      
    # Wind components for calculations (LOW priority)
    wind_u:
      grib_parameter: "UGRD"
      database_field: "wind_u"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 3
      description: "U-component of wind"
      
    wind_v:
      grib_parameter: "VGRD"
      database_field: "wind_v"
      database_type: "REAL"
      unit_conversion_required: true
      forecast_priority: 3
      description: "V-component of wind"

# =============================================================================
# BATHYMETRY DATA SOURCE - Future data source placeholder
# =============================================================================
bathymetry_data:
  # Placeholder for future bathymetry API configuration
  # Will be added when bathymetry integration is implemented
  description: "Placeholder for future bathymetry data integration"
  enabled: false

# =============================================================================
# FISH CATEGORIES - User-configurable species targeting
# =============================================================================
fish_categories:
  freshwater_sport:
    display_name: "Freshwater Sport Fish"
    species: ["Bass", "Trout", "Pike", "Walleye"]
    pressure_preference: "falling"
    tide_relevance: false
    
  saltwater_inshore:
    display_name: "Saltwater Inshore"
    species: ["Redfish", "Snook", "Flounder", "Spotted Sea Trout"]
    pressure_preference: "falling"
    tide_relevance: true
    
  saltwater_offshore:
    display_name: "Saltwater Offshore"
    species: ["Mahi", "Tuna", "Marlin", "Wahoo"]
    pressure_preference: "stable"
    tide_relevance: false
    
  bottom_fish:
    display_name: "Bottom Fish"
    species: ["Grouper", "Snapper", "Halibut", "Cod"]
    pressure_preference: "stable_high"
    tide_relevance: true

scoring_criteria:
  # =============================================================================
  # SURF SCORING - Physics-Based Post-Transformation Scoring
  # =============================================================================
  surf_scoring:
    
    # Physics parameters for wave transformation (user-tunable)
    physics_parameters:
      shoaling_factor_max: 1.5         # Maximum shoaling amplification
      refraction_factor_max: 1.2       # Maximum refraction focusing
      breaking_gamma_sand: 0.78        # Breaking index for sand bottoms
      breaking_gamma_reef: 1.0         # Breaking index for reef breaks
      bottom_friction_coefficient: 0.01 # Energy loss coefficient
      
    # Wave height scoring (applied AFTER physics transformation)
    transformed_wave_height_scoring:
      ranges:
        0.0-0.5: 0.1     # Flat
        0.5-1.5: 0.4     # Tiny
        1.5-3.0: 0.8     # Small
        3.0-6.0: 1.0     # Good
        6.0-10.0: 0.9    # Large
        10.0-15.0: 0.6   # Very large
        15.0+: 0.2       # Dangerous
      
    # Wave period scoring (swell quality assessment)
    wave_period_scoring:
      ranges:
        0-6: 0.2         # Poor wind swell
        6-8: 0.4         # Short period
        8-10: 0.6        # Mixed swell
        10-12: 0.8       # Good swell
        12-16: 1.0       # Excellent groundswell
        16-20: 0.9       # Very long period
        20+: 0.8         # Extremely long
        
    # Wind quality (relative to surf spot orientation)
    wind_quality_scoring:
      offshore_optimal: 1.0     # Clean offshore winds
      offshore_light: 0.9       # Light offshore
      offshore_strong: 0.6      # Strong offshore (blown out)
      cross_shore: 0.5          # Side winds
      onshore_light: 0.3        # Light onshore
      onshore_strong: 0.1       # Strong onshore (junky)
      calm_glassy: 1.0          # No wind (glassy)
      
    # Wind speed thresholds for quality classification
    wind_speed_thresholds:
      calm_max: 3               # mph
      light_max: 8              # mph  
      moderate_max: 15          # mph
      strong_max: 25            # mph
      dangerous_min: 30         # mph
      
    # Overall rating calculation weights
    scoring_weights:
      wave_height: 0.35         # Transformed wave height importance
      wave_period: 0.35         # Swell quality importance
      wind_quality: 0.20        # Wind condition importance
      tide_phase: 0.10          # Tidal effects importance
      
  # =============================================================================
  # FISHING SCORING - Enhanced Species-Specific Scoring
  # =============================================================================
  fishing_scoring:
    
    # Pressure trend scoring (barometric effects on fish behavior)
    pressure_trend_scoring:
      ranges:
        rising_fast: 0.2          # Fish shut down
        rising_slow: 0.6          # Slow fishing
        stable_high: 1.0          # Excellent conditions
        stable_low: 0.5           # Fair conditions  
        falling_slow: 0.9         # Very good fishing
        falling_fast: 0.7         # Good before front
        
    # Pressure rate thresholds (mb/hour)
    pressure_rate_thresholds:
      fast_change_min: 2.0       # mb/hour for "fast" changes
      slow_change_max: 0.5       # mb/hour for "slow" changes
      stable_range: 0.2          # mb/hour for "stable"
      
    # Tide phase scoring (species-dependent)
    tide_phase_scoring:
      incoming: 0.8             # Rising tide
      high_slack: 0.4           # High tide slack
      outgoing: 1.0             # Falling tide (best)
      low_slack: 0.3            # Low tide slack
      
    # Time of day modifiers
    time_of_day_scoring:
      dawn: 1.0                 # Early morning feeding
      morning: 0.7              # Mid morning
      midday: 0.4               # Noon (typically slower)
      afternoon: 0.6            # Afternoon pickup
      dusk: 1.0                 # Evening feeding
      night: 0.8                # Night fishing
      
    # Species activity modifiers (by category)
    species_activity_modifiers:
      saltwater_inshore: 1.0    # Base multiplier
      saltwater_offshore: 0.8   # Less tide dependent
      freshwater_sport: 0.6     # Less pressure dependent
      bottom_fish: 1.2          # More responsive to conditions
      
    # Overall fishing rating weights
    scoring_weights:
      pressure_trend: 0.4       # Barometric pressure importance
      tide_phase: 0.3           # Tidal effects importance
      time_of_day: 0.2          # Time effects importance
      species_activity: 0.1     # Species-specific modifiers

# =============================================================================
# BATHYMETRY DATA SOURCE - GEBCO API via OpenTopo
# =============================================================================
bathymetry_data:
  description: "GEBCO Global Bathymetry - Multi-Point Path Analysis"
  data_source: "gebco_api"
  implementation_scope: "install_time_only"
  
  # API configuration for OpenTopo Data API
  api_configuration:
    base_url: "https://api.opentopodata.org/v1/gebco2020"
    timeout_seconds: 30
    retry_attempts: 3
    retry_delay_seconds: 2
    max_locations_per_request: 100
    rate_limit_delay: 1.1
    
  # Attribution requirements
  attribution:
    dataset: "GEBCO Compilation Group (2025) GEBCO 2025 Grid"
    source: "Bathymetry data via OpenTopo Data API"
    disclaimer: "Not for navigation or safety at sea"
    
  # Multi-point bathymetric path analysis
  path_analysis:
    enable_multi_point_path: true
    path_resolution_points: 5
    total_points_per_spot: 7
    offshore_distance_meters: 10000
    interpolation_method: "bilinear"
    
  # Validation thresholds
  validation_thresholds:
    max_offshore_depth: 50.0
    min_offshore_depth: 20.0
    max_nearshore_depth: 10.0
    min_nearshore_depth: 1.0
    max_path_distance_km: 15.0
    
  # Fallback configuration
  fallback_configuration:
    enable_fallback: true
    require_user_consent: true
    show_accuracy_warning: true
    allow_installation_abort: true
    default_path_depths: [40.0, 32.0, 24.0, 16.0, 8.0, 4.0, 2.5]
    accuracy_impact_estimate: "30-40% less precise"
    retry_attempts_before_fallback: 3
    
  # Land/sea validation
  coordinate_validation:
    enable_land_sea_validation: true
    land_elevation_threshold: 0.0
    validate_fishing_spots: true
    validate_surf_spots: true
    auto_adjust_coordinates: false